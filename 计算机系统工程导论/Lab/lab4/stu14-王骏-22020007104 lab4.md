# 《计算机系统工程》实验报告

- 实验名称： Traceroute
- 姓名：王骏
- 学号：220 2000 7104
- 专业年级： 2022级 计算机科学与技术
- 日期：2025-04-26



## 实验目的

1.  学习Ping和Traceroute工具的使用
2. 巩固课堂学习的因特网分层设计实现知识，理解因特网的分组
   转发网络的特性
3. 学习在分层设计中进行跨层通信的设计实现方法
4. 体会在实践中体会设计方案在解决问题的同时是如何带来新的设
   计机会的

## 实验过程与习题

### Ping应用

使用man命令简单了解ping命令的作用，认真阅读descirption的内容，并用不超过200字进行简要概括。

使用ping，对www.sdu.edu.cn发送10个长度为56字节的数据包。

使用ping，对www.ouc.edu.cn发送长度为56字节的50个数据包。

记录结果。（注意命令参数）

#### **问题1：**用不超过200字简要概括ping命令；

如图1：

值得一提的是，服务器提供的虚拟环境并不支持任何sudo指令，同时呢服务器上也并没有安装ping指令，也就意味着，在实验的环境是不可能使用ping指令的，体现出了作者的独特的幽默风趣，以及侧向证明了在某种层面上这个服务器以及实验环境毫无意义，同时呢学生还需要在这个毫无意义的实验环境中满足一定数量的操作，嗯，这大概是我见过的最含金量的实验了。

所以只能在本地实现ping指令，Linux虚拟环境

通过这个man手册的繁杂的，臃肿的，冗杂的，学院派的，准确的，精彩的介绍之后，大概可以知道：

ping 命令使用 ICMP 协议的 ECHO_REQUEST 数据报来请求目标主机应答。它监听从目标主机返回的 ICMP ECHO_RESPONSE 响应。

主要目的是测试网络上某台主机是否可达。通过发送请求并等待响应，ping 可以有效地判断目标主机是否在线以及网络连接是否通畅。

ping 会报告每个响应包的往返时间RTT，这有助于评估网络延迟。它还会统计丢包率，反映网络连接的稳定性。



#### **问题2：**说明实验现象背后的原因；

如图2:

**收到回复 (Reply from...)**:

原因: 这表示计算机成功发送了一个 ICMP ECHO_REQUEST包给目标主机 www.sdu.edu.cn的 IP 地址，并且目标主机成功接收并回复了一个 ICMP ECHO_RESPONSE 包，该包被计算机接收到

- 目标主机在线且网络接口正常工作。
- 网络路径是通畅的（至少在你和目标主机之间的大部分路径）。
- 目标主机或路径上的防火墙允许 ICMP 请求和响应通过。

如图3：

所有的包都丢失了，也没有收到任何回复，大概是因为这是一所注重网络安全的学校，别人不能随便ping的，或者因为网络质量差或存在问题。



#### **问题3：**通过查询资料，画出所使用的ICMP数据包的结构。

 如图4：



### traceroute应用

使用man命令简单了解traceroute命令的作用。

使用traceroute www.baidu.com,尝试确定从源计算机到 www.baidu.com的路径，并思考输出结果每个字段的意义。记录输出结果。

#### **问题4**：用不超过200字简要概括traceroute命令；

如图5：

`traceroute`是一个网络诊断命令，用于追踪数据包从计算机到目标主机所经过的路径。它通过发送一系列生存时间TTL逐渐增加的探测包，记录沿途每个路由器的IP地址和往返时间，从而显示数据包的传输路径和延迟情况。有助于诊断网络连接问题，确定数据包在哪一跳出现延迟或丢失。

#### **问题5：**确定并说明从源计算机到 www.baidu.com的路径；

如图6：

在Linux虚拟环境下，因为NAT模式工作原理会导致traceroute显示的全是*

所以接下来在Windows环境进行实验：

**跃点 1:** `10.142.220.1` - 这是本地网络中的第一个网关或路由器。往返时间非常低，约为 2-3 毫秒。

**跃点 2:** `10.70.3.1` - 这是网络中的下一个路由器，延迟略有增加，约为 4-5 毫秒。

**跃点 3:** `* * * 请求超时。` - 在第三跳，没有收到任何响应。这可能是由于该路由器配置为不响应 `traceroute` 的探测包，或者暂时存在网络问题。

**跃点 4:** `211.64.145.93` - 数据包继续前进，到达 IP 地址为 `211.64.145.93` 的路由器，往返时间约为 3-4 毫秒。这可能属于您的互联网服务提供商 (ISP) 的网络。

**跃点 5-8:** `* * * 请求超时。` - 连续四个跃点都显示请求超时。这很可能表明这些路由器配置为不响应 `traceroute` 探测，以增强安全性或避免不必要的网络流量。

**跃点 9:** `110.242.66.170` - 数据包到达 IP 地址为 `110.242.66.170` 的路由器，往返时间显著增加到 20-21 毫秒。这很可能是在百度服务器所在的网络中。

**跃点 10:** `221.194.45.134` - 接下来到达 IP 地址为 `221.194.45.134` 的路由器，往返时间略有下降，约为 18-20 毫秒。

**跃点 11-13:** `* * * 请求超时。` - 再次出现连续的请求超时，原因可能与之前的类似，即这些路由器不响应 `traceroute` 探测。

**跃点 14:** `110.242.68.66` - 最终到达目标 IP 地址 `110.242.68.66`，即 `www.baidu.com` 的服务器之一。往返时间约为 18 毫秒。

#### **问题6**：说明输出结果每个字段的意义。

**每一行：跃点信息**

每一行代表数据包在到达目标主机过程中经过的一个路由器（跃点）。

1. **`1` 到 `14`**: 这是**跃点编号**，表示数据包经过的第几个路由器。从计算机开始计数。
2. **`3 ms`  `2 ms`  `2 ms` **: **往返时间 RTT**，表示发送到该跃点并接收到响应的三个探测包所花费的时间，单位是毫秒 (ms)。
   - 较低的 RTT 值表示与该路由器的网络延迟较小。
   - 较高的 RTT 值可能表示网络拥塞、路由器负载过高或物理距离较远。
   - 显示三个 RTT 值是因为 `traceroute` 默认会向每个跃点发送三个探测包以获得更稳定的延迟估计。
3. **`* * * 请求超时。`**: 星号 (`*`) 表示在设定的时间内没有收到来自该跃点的响应。
4. **`10.142.220.1` **: 这是该跃点的**IP 地址**。它唯一地标识了网络中的一个设备。
5. **主机名**: 在 IP 地址后面，有时会显示通过反向 DNS 查询解析得到的主机名。

**最后一行：**

- **`跟踪完成。`**: 表明 `traceroute` 命令执行完毕，已经尝试跟踪到目标主机或达到了最大跃点数限制

## traceroute探索

在命令提示符下，输入:traceroute 18.31.0.200 。

描述观察到的输出有什么特殊性，思考为什么traceroute会给出这样的输出。查阅traceroute手册获得帮助。

使用traceroute分析从源地址到www.baidu.com和到cn.bing.com的网络路径差异。

#### **问题7**：解释traceroute 18.31.0.200的输出。

如图7：

与之前的结果不同的是

**`tpr5-et0-1-9-v4005.jp.apan.net [203.181.248.250]` **: 在 IP 地址后面，显示通过反向 DNS 查询解析得到的主机名。主机名通常能提供一些关于路由器位置或所属组织的信息。方括号 `[ ]` 内是该主机名对应的 IP 地址，以确保识别的准确性。

**跃点 18 和 19:** 可以看到主机名中包含 `.jp.apan.net`，这表明数据包已经到达日本的 APAN（Asia Pacific Advanced Network）。延迟显著增加。

**跃点 20 到 27:** 主机名中包含 `.net.internet2.edu`，这表明数据包正在通过 Internet2 网络传输，这是一个美国的学术互联网网络。延迟持续增加。这些跃点显示了数据包在美国不同地区的服务器之间跳转。

**跃点 28 到 30:** 主机名中包含 `.nox.org` 和 `.mit.edu`，表明数据包已经接近目标网络，可能是MIT。最终到达的 IP 地址 `18.2.4.110` 属于 MIT 的地址段，但与最初的目标 `18.31.0.200` 不同。

#### **问题8 ：**说明从源地址到www.baidu.com和到cn.bing.com的网络路径差异。

www.baidu.com如图6:

cn.bing.com如图8:

**前几跳相同:** 从跃点 1 到跃点 4，两条路径完全一致，都经过了本地网络 (`10.142.220.1`, `10.70.3.1`) 和 ISP 的早期路由器 (`211.64.145.93`)，延迟也基本相同。

**ISP 网络不同:**

- 到 `cn.bing.com` 的路径在跃点 5 经过了 `211.64.145.61`，而到 `www.baidu.com` 的路径在跃点 5 就出现了超时。这表明数据包在 ISP 网络中选择了不同的路由。
- 到 `cn.bing.com` 的路径在跃点 6 经过了 `100.64.163.1`，而到 `www.baidu.com` 的路径在跃点 6-8 都是超时。这进一步说明了在 ISP 内部，数据包的转发路径是不同的。
- 两条路径在跃点 7 和 8 都经过了 `101.4.113.50` 和 `100.64.62.1`，延迟也比较接近。

**国内外网络差异显著:**

- 从跃点 9 开始，两条路径就呈现出明显的差异。到 `www.baidu.com` 的路径在跃点 9 到达 `110.242.66.170`，后续经过 `221.194.45.134`，最终到达 `110.242.68.66`。这些 IP 地址都属于中国的网络范围。
- 到 `cn.bing.com` 的路径在跃点 9 经过 `101.4.116.118`，跃点 15 经过 `218.30.104.245`，跃点 16 经过 `218.30.25.86`，跃点 18 经过 `13.104.184.81`，最终到达 `202.89.233.100`。可以看到，`cn.bing.com` 的路径似乎更复杂，中间经过了IP 地址 `13.104.184.81` (属于微软)的网络，最终到达的 IP 地址 `202.89.233.100` 也属于中国的网络范围，但与百度的 IP 段不同。

#### **问题9：**如果在IPv6上实现路径探测，应该使用包头的哪个字段？

如果在 IPv6 上实现路径探测，应该使用包头的 **跳数限制 `Hop Limit`** 字段

在 IPv4 中，`traceroute` 命令通过发送一系列生存时间TTL 字段值逐渐增加的 `UDP` 或 `ICMP` 包来实现路径探测。当路由器收到 `TTL` 值为 1 的数据包时，会丢弃该数据包并发送一个 `ICMP Time Exceeded` 消息给源主机。通过逐步增加 TTL 值，`traceroute` 可以记录下数据包到达目标主机所经过的每个路由器。

IPv6 包头中没有 `TTL` 字段，取而代之的是 **跳数限制 `Hop Limit`** 字段。它的功能与 IPv4 的` TTL `字段完全相同，用于限制 IPv6 数据包在网络中可以经过的最大路由器跳数，以防止数据包在出现路由环路时无限循环

## 遇到的问题及解决方式

1. 实验环境无法`root`,无法使用`sudo`指令,无法下载`ping`和`traceroute`等指令需要的依赖

   解决方式:本地`Linux`虚拟环境和`Windows`环境

2. `Linux`虚拟环境无法`traceroute`: 显示的路径全部是*

   解决方式: 因为`Linux`环境下使用了`NAT`连接网络,导致了一些潜在的问题致使路径全部是*,所以使用`Windows`环境的`tracert`指令平替,正常进行实验

## 课后实验与思考（选做）

## 实验总结

 成功地使用 `traceroute` 命令追踪了从源计算机到 `www.baidu.com` 和 `cn.bing.com` 的网络路径。通过分析输出结果，了解了每个跃点代表一个路由器，并能获取其 IP 地址（有时还有主机名）以及往返时间。观察到，即使目标都在中国，访问 `www.baidu.com` 和 `cn.bing.com` 的网络路径也存在显著差异，这体现了不同互联网服务提供商和内容分发网络的架构特点。路径中出现的 `*` 表示某些路由器可能不响应 `traceroute` 的探测。确认了在 IPv6 网络中，路径探测功能通过修改和分析 **跳数限制 `Hop Limit` **字段以及接收` ICMPv6 Time Exceeded` 消息来实现，与 IPv4 中使用 `TTL` 字段的原理类似。





## 实验数据与记录

见附件`stu14-王骏-22020007104 lab4.docx`
