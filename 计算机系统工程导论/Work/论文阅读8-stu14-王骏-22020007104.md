# 论文阅读8

姓名：王骏

学号：22020007104



**问题：**

​    读其中关于用推测执行进行信息传递的内容，思考：

##     a. 它是怎么传递信息的？

1. **诱导推测执行**：攻击者精心构造一段代码，使得CPU在推测执行过程中访问攻击者想要泄露的秘密数据。
2. **利用缓存作为侧信道**：当CPU推测执行时，它会根据访问的秘密数据，将某些内存地址的数据加载到**高速缓存**中。
3. **计时测量**：推测执行完成后，CPU会撤销无效的推测执行结果，但是推测执行过程中对缓存的影响（即某些数据被加载到缓存中）却**不会被撤销**。攻击者随后通过**精确计时**来测量访问某些内存地址所需的时间。如果某个地址的数据在推测执行时被加载到缓存中，那么后续访问它的时间就会显著缩短；反之，如果不在缓存中，则访问时间会更长。
4. **推断秘密**：通过分析不同内存访问时间的差异，攻击者可以推断出推测执行过程中访问了哪些秘密数据，从而泄露信息。



##     b. 为什么不能直接通过内存或寄存器传递信息？

1. **隔离机制**：现代操作系统和硬件都设计了严格的隔离机制，例如**用户/内核模式隔离**、**进程地址空间隔离**等。这些机制确保一个进程无法直接访问另一个进程的内存或内核的内存，也无法直接访问不属于自己的寄存器。
2. **权限限制**：用户程序只能访问其被授权的内存区域和寄存器。尝试访问未授权的内存或寄存器会触发页错误（page fault）或通用保护错误（general protection fault），导致程序崩溃。
3. **安全边界**：Spectre攻击利用的是CPU**推测执行的副作用**，而不是直接违反权限访问内存或寄存器。推测执行发生在CPU内部，其结果在“推测”错误时会被回滚，但其对缓存等硬件状态的**微架构副作用**却不会回滚，这正是攻击的突破口。

##     c.什么是Spectre攻击？

**Spectre攻击**是一种利用现代CPU中**推测执行（speculative execution）机制漏洞的侧信道攻击（side-channel attack）**。它允许恶意程序（甚至是在沙箱中运行的程序）通过观察CPU的微架构状态（例如缓存行为）来窃取**受保护内存中的敏感信息**，即使这些信息在正常执行路径下是不可访问的。

##     d.它是怎么发生的？

1. **推测执行（Speculative Execution）**：为了提高CPU性能，现代处理器会预测程序分支的走向，并在预测正确的情况下**提前执行**代码。如果预测错误，CPU会回滚推测执行的结果，但**推测执行过程中对微架构状态（如缓存）的修改不会被完全回滚**。
2. **受害者程序**：攻击者需要找到一个目标程序（受害者），该程序会根据敏感信息的值来执行不同的代码路径，或者在某些条件下访问敏感数据。
3. **分支预测器（Branch Predictor）操纵**：攻击者通过精心构造训练数据，**欺骗CPU的分支预测器**，使其预测错误。例如，攻击者可以让分支预测器认为某个条件（比如数组索引检查）会通过，从而在推测执行时执行到访问敏感数据的代码。
4. **侧信道泄露**：当CPU根据错误预测执行到敏感数据的代码时，它会将敏感数据加载到缓存中。即使之后CPU发现预测错误并回滚了寄存器和内存的状态，**缓存中的数据却依然存在**。攻击者随后通过**定时攻击**（测量内存访问时间）来检测哪些数据被加载到了缓存中，从而推断出敏感信息的值。

##     e.是什么原因使得该攻击变得可行？（或：为什么Intel不简单禁掉这项功能？）

1. **推测执行的普遍性及其微架构副作用的不回滚**：推测执行是现代高性能CPU（包括Intel、AMD和ARM）中**普遍存在的性能优化技术**。它极大地提高了CPU的指令吞吐量。然而，推测执行的一个关键特性是，虽然其**架构状态（如寄存器值、内存内容）**在预测错误时会被回滚，但其**微架构状态（如缓存内容、分支预测器状态）**的副作用却不会被完全回滚。正是这些未回滚的微架构副作用成为了侧信道。
2. **分支预测的固有不精确性**：分支预测器是为了避免CPU等待分支判断结果而设计的。它根据历史数据预测分支走向。虽然准确率很高，但**不可能做到100%准确**，总会有预测错误的时候。Spectre攻击正是利用了这种预测错误，诱导CPU进行推测执行。
3. **侧信道的普遍性**：缓存、乱序执行单元、TLB（Translation Lookaside Buffer）等现代CPU的许多性能优化机制都会产生**时间上的差异**，而这些差异正是侧信道的来源。这些侧信道在设计之初并未被视为安全漏洞，而是性能优化的副产品。
4. **软件和硬件之间信任边界的模糊**：传统的安全模型认为，软件通过内存权限和特权级别来建立严格的隔离。然而，Spectre揭示了**微架构层面**存在一个隐式的、未受保护的信息通道，这个通道可以跨越传统的软件安全边界。